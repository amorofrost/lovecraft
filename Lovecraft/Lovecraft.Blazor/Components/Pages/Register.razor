@page "/register"
@inject NavigationManager Navigation
@inject AuthService AuthService

<h3>Create account</h3>

@if (error != null)
{
    <p style="color:red">@error</p>
}

<div>
    <div><label>Login (username): <input @bind="model.Username" /></label></div>
    <div><label>Password: <input type="password" @bind="model.Password" /></label></div>
    <div><label>Name: <input @bind="model.Name" /></label></div>
    <div><label>Avatar URL: <input @bind="model.AvatarUri" /></label></div>
    <div style="margin-top:0.5rem">
        <button @onclick="OnCreate">Create</button>
        <a href="/">Back</a>
    </div>
</div>

@code {
    private CreateModel model = new();
    private string? error;

    private class CreateModel { public string Username { get; set; } = string.Empty; public string Password { get; set; } = string.Empty; public string Name { get; set; } = string.Empty; public string AvatarUri { get; set; } = string.Empty; }

    private async Task OnCreate()
    {
        error = null;
        try
        {
            var created = await AuthService.RegisterAsync(model.Username, model.Password, model.Name, model.AvatarUri);
            if (created != null)
            {
                Navigation.NavigateTo($"/profile");
            }
            else
            {
                error = "Registration failed";
            }
        }
        catch (Exception ex)
        {
            error = ex.Message;
        }
    }
}
